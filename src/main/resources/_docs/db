/*------------------ Системные сущности  -----------------------*/

/*Роли системных и всех пользователей*/
CREATE SEQUENCE role_id_seq START WITH 1;

CREATE TABLE "role" (
    id INTEGER NOT NULL default nextval('role_id_seq') PRIMARY KEY,
	role VARCHAR(240) NOT NULL,
	role_about VARCHAR(240) NOT NULL
);
ALTER SEQUENCE role_id_seq owned by "role".id;

INSERT INTO "role" (id, role, role_about) VALUES
(1, 'ADMIN', 'Системный администратор'),
(2, 'SYSUSER', 'Системный пользователь'),
(3, 'MANAGER', 'Менеджер'),
(4, 'MASTER', 'Мастер'),
(5, 'CLIENT', 'Клиент');


/*Пользователи системы*/
CREATE SEQUENCE user_id_seq START WITH 1;

CREATE TABLE "users" (
    id INTEGER NOT NULL default nextval('user_id_seq') PRIMARY KEY,
	email VARCHAR(120) NOT NULL,
	phone VARCHAR(10) DEFAULT NULL,
	pass VARCHAR(255) NOT NULL,
	owner_user_id INTEGER REFERENCES "users"(id) DEFAULT NULL,
	name VARCHAR(255) DEFAULT NULL,
	sirname VARCHAR(255) DEFAULT NULL,
	active BOOLEAN
);
ALTER SEQUENCE user_id_seq owned by "users".id;

/*дополнительная таблица с данными пользователями
или
таблица с динамическими полями*/


/*Роли пользователя*/
CREATE TABLE "user_role" (
    user_id INTEGER REFERENCES "users"(id),
	role_id INTEGER REFERENCES "role"(id)
);


/*Баланс денег пользователя системы*/
/*
CREATE SEQUENCE sys_balance_id_seq START WITH 1;

CREATE TABLE "sys_balance" (
    id INTEGER NOT NULL default nextval('sys_balance_id_seq'),
);
ALTER SEQUENCE sys_balance_id_seq owned by "sys_balance".id;
*/


/*------------------ Клиентские сущности ----------------------*/

/*Помещения/залы/комнаты/рабочие места*/
CREATE SEQUENCE room_id_seq START WITH 1;

CREATE TABLE "room" (
    id INTEGER NOT NULL default nextval('room_id_seq') PRIMARY KEY,
    owner_user_id INTEGER REFERENCES "users"(id),
	name VARCHAR(240) NOT NULL,
	active BOOLEAN
);
ALTER SEQUENCE room_id_seq owned by "room".id;


/*Услуги*/
CREATE SEQUENCE product_id_seq START WITH 1;

CREATE TABLE "product" (
    id INTEGER NOT NULL default nextval('product_id_seq') PRIMARY KEY,
    name VARCHAR(240) NOT NULL,
    room_id INTEGER REFERENCES "room"(id),
    active BOOLEAN
);
ALTER SEQUENCE product_id_seq owned by "product".id;


/*Услуги пользователя - Профиль специалиста - many-to-many*/
CREATE SEQUENCE user_product_id_seq START WITH 1;

CREATE TABLE "user_product" (
    id INTEGER NOT NULL default nextval('user_product_id_seq') PRIMARY KEY,
    user_id INTEGER REFERENCES "users"(id),
	product_id INTEGER REFERENCES "product"(id),
	active BOOLEAN
);
ALTER SEQUENCE user_product_id_seq owned by "user_product".id;


/*Рассписание специалиста*/
CREATE SEQUENCE schedule_id_seq START WITH 1;

CREATE TABLE "schedule" (
    id INTEGER NOT NULL default nextval('schedule_id_seq') PRIMARY KEY,
    owner_user_id INTEGER,
	sdate TIMESTAMP
);
ALTER SEQUENCE schedule_id_seq owned by "schedule".id;